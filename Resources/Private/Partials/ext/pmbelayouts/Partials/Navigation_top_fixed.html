<!DOCTYPE html>
<!--
Copyright (C) 2020 PARAT Beteiligungs GmbH
Markus Blöchl <mbloechl@parat.eu>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<!-- Top Navigation Fixed -->    
{namespace h = Pmwebdesign\Pmbelayouts\ViewHelpers}
{namespace s = Pmwebdesign\Staffm\ViewHelpers}
<f:alias map="{loggedIn: '{s:finduser()}'}">
<div id="top" class="header">
    <div class="headerline"></div>     
    <f:if condition="{bgimagewrap}!=''"> 
        <f:then>
            <nav id="mainnav" class="navbar navbar-expand-lg navbar-light fixed-top mainnav white">
        </f:then>
        <f:else>
            <nav id="mainnav" class="navbar navbar-expand-lg navbar-light fixed-top mainnav black">
        </f:else>
    </f:if>  
        <div class="container">  
            <a class="navbar-brand navbarbrandmain mb-2" title="Home" href="{baseUrltext}">
                <f:if condition="{bgimagewrap}!=''">
                    <f:then>
                        <f:cObject typoscriptObjectPath="obj.logo" />
                    </f:then>
                    <f:else>
                        <f:cObject typoscriptObjectPath="obj.logobl" />
                    </f:else>
                </f:if>
            </a>        
            <button id="navbutton" type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" aria-label="Toggle Navigation">                
                <span class="navbar-toggler-icon"></span>               
            </button>        
            <div id="navbar" class="collapse navbar-collapse navbarcollapsemain">                
                <f:cObject typoscriptObjectPath="lib.navbar" />     
                <f:security.ifAuthenticated>
                    <f:then>
                        <f:comment><!-- logout --></f:comment>
                        <form class="form-inline" target="_top" method="post" action="/">
                            <div class="form-group">
                                <div style="text-transform:none" class="nav-link logoutname mr-sm-2">
                                    <div class="row">
                                        <div class="col-sm text-center justify-content-center align-self-center">
                                            <f:link.page title="grün: anwesend, rot: abwesend" pageUid="{s:getPageId(extensionName: 'staffm', sectionName: 'settings', constantName: 'pageIdProfil')}" class="nav-link" additionalParams="{tx_staffm_staffmvorg: {userKey: 'auswahlUsr'}, tx_staffm_staffmvorg: {art: 'profileedit'}, tx_staffm_staffmvorg: {mitarbeiter: '{loggedIn}'}}">
                                                <f:if condition="{loggedIn.present}">
                                                    <f:then>
                                                        <svg style="color: #43F73A" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16">
                                                            <circle cx="8" cy="8" r="8"/>
                                                        </svg>
                                                    </f:then>
                                                    <f:else>
                                                        <svg style="color: #F40000" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16">
                                                            <circle cx="8" cy="8" r="8"/>
                                                        </svg>
                                                    </f:else>
                                                </f:if>
                                            </f:link.page>
                                        </div>
                                        <div class="col-sm-auto text-center justify-content-center align-self-center">
                                            <h:getNameLoggedInUser/>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-link">
                                    <div class="btn-group dropdown">
                                        <input name="submit" value="Logout" type="submit" class="btn btn-primary btn-sm">
                                        <button type="button" class="btn btn-secondary btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="sr-only">Toggle Dropdown</span>
                                        </button>
                                        <f:comment><!-- all menu entries --></f:comment>
                                        <div class="dropdown-menu">
                                                        
                                            <f:comment><!-- Profil bearbeiten --></f:comment>
                                            <f:link.page pageUid="{s:getPageId(extensionName: 'staffm', sectionName: 'settings', constantName: 'pageIdProfil')}" class="nav-link" additionalParams="{tx_staffm_staffmvorg: {userKey: 'auswahlUsr'}, tx_staffm_staffmvorg: {art: 'profileedit'}, tx_staffm_staffmvorg: {mitarbeiter: '{loggedIn}'}}">Profil bearbeiten</f:link.page>
                                            
                                            <f:comment><!-- Mitarbeiter bearbeiten / only PA--></f:comment>
                                            <f:security.ifHasRole role="PA">
                                                <f:link.page pageUid="{s:getPageId(extensionName: 'staffm', sectionName: 'settings', constantName: 'pageIdMitarbeiter')}" class="nav-link">Mitarbeiter bearbeiten</f:link.page>
                                            </f:security.ifHasRole>
                                        </div>
                                    </div>
                                    <input type="hidden" name="logintype" value="logout" >
                                    <input type="hidden" name="pid" value="{$pid_feuser}">
                                    <input type="hidden" name="tx_felogin_pi1[noredirect]" value="0">	
                                </div>
                            </div>
                        </form>
                    </f:then>
                    <f:else>
                        <f:comment><!-- login --></f:comment>
                        <form class="form-inline" action="/" enctype="multipart/form-data" method="post" class="loginform">        
                            <div class="form-group">
                                <input name="logintype" value="login" type="hidden" />
                                <input name="pid" value="42" type="hidden" />
                                <div class="nav-link">
                                    <label for="name" class="sr-only">Username</label>
                                    <input name="user" size="7" placeholder="Username" value="" onfocus="if(this.value=='Username') this.value='';" onblur="if(this.value=='') this.value='Username';" type="text" id="user" class="form-control form-control-sm mr-sm-2" required />
                                    <label for="pass" class="sr-only">Password</label>
                                    <input name="pass" size="7" value="Dein Passwort" onfocus="if(this.value=='Dein Passwort') this.value='';" onblur="if(this.value=='') this.value='Dein Passwort';" data-rsa-encryption="" type="password" id="pass" class="form-control form-control-sm mr-sm-2" />
                                    <input name="submit" value="Login" type="submit" class="btn btn-primary btn-sm" />
                                </div>
                            </div>
                        </form>
                    </f:else>
                </f:security.ifAuthenticated>
                
                <f:cObject typoscriptObjectPath="lib.languagebt" />
            </div>
        </div>
    </div>
</f:alias>